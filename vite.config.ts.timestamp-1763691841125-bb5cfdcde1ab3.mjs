// vite.config.ts
import { defineConfig } from "file:///D:/code/templars-final-stand-main/templars-final-stand-main/node_modules/.pnpm/vite@5.4.1_@types+node@22.3.0_terser@5.31.6/node_modules/vite/dist/node/index.js";
import path from "path";
import fs from "fs/promises";
import typescriptPlugin from "file:///D:/code/templars-final-stand-main/templars-final-stand-main/node_modules/.pnpm/@rollup+plugin-typescript@1_1fb2a9945a6e19e9b55f494a5ae59b02/node_modules/@rollup/plugin-typescript/dist/es/index.js";
import { Packer } from "file:///D:/code/templars-final-stand-main/templars-final-stand-main/node_modules/.pnpm/roadroller@2.1.0/node_modules/roadroller/index.mjs";
import CleanCSS from "file:///D:/code/templars-final-stand-main/templars-final-stand-main/node_modules/.pnpm/clean-css@5.3.3/node_modules/clean-css/index.js";
import { statSync } from "fs";
import { execFileSync } from "child_process";
import ect from "file:///D:/code/templars-final-stand-main/templars-final-stand-main/node_modules/.pnpm/ect-bin@1.4.1/node_modules/ect-bin/index.js";
import htmlMinify from "file:///D:/code/templars-final-stand-main/templars-final-stand-main/node_modules/.pnpm/html-minifier@4.0.0/node_modules/html-minifier/src/htmlminifier.js";
import kontra from "file:///D:/code/templars-final-stand-main/templars-final-stand-main/node_modules/.pnpm/rollup-plugin-kontra@1.0.1/node_modules/rollup-plugin-kontra/src/index.js";
var __vite_injected_original_dirname = "D:\\code\\templars-final-stand-main\\templars-final-stand-main";
var vite_config_default = defineConfig(({ command, mode }) => {
  const config = {
    server: {
      port: 3e3
    },
    resolve: {
      alias: {
        "@": path.resolve(__vite_injected_original_dirname, "./src")
      }
    },
    plugins: void 0
  };
  if (command === "build") {
    config.esbuild = false;
    config.base = "";
    config.build = {
      minify: "terser",
      target: "es2020",
      modulePreload: { polyfill: false },
      assetsInlineLimit: 800,
      assetsDir: "",
      rollupOptions: {
        output: {
          inlineDynamicImports: true,
          manualChunks: void 0,
          assetFileNames: `[name].[ext]`
        }
      }
    };
    config.plugins = [
      typescriptPlugin(),
      closurePlugin(),
      kontra({
        gameObject: {
          anchor: true,
          group: true,
          opacity: true,
          scale: true,
          radius: true
        },
        text: {
          align: true,
          newline: true
        }
      }),
      roadrollerPlugin(),
      ectPlugin()
    ];
  }
  return config;
});
function closurePlugin() {
  return {
    name: "closure-compiler",
    // @ts-ignore
    renderChunk: applyClosure,
    enforce: "post"
  };
}
async function applyClosure(js, chunk) {
  js = js.replaceAll("const ", "let ");
  return new Promise((resolve, reject) => {
    resolve({ code: js });
  });
}
function roadrollerPlugin() {
  return {
    name: "vite:roadroller",
    transformIndexHtml: {
      enforce: "post",
      transform: async (html, ctx) => {
        if (!ctx || !ctx.bundle) {
          return html;
        }
        const options = {
          includeAutoGeneratedTags: true,
          removeAttributeQuotes: true,
          removeComments: true,
          removeRedundantAttributes: true,
          removeScriptTypeAttributes: true,
          removeStyleLinkTypeAttributes: true,
          sortClassName: true,
          useShortDoctype: true,
          collapseWhitespace: true,
          collapseInlineTagWhitespace: true,
          removeEmptyAttributes: true,
          removeOptionalTags: true,
          sortAttributes: true,
          minifyCSS: true
        };
        const bundleOutputs = Object.values(ctx.bundle);
        const javascript = bundleOutputs.find(
          (output) => output.fileName.endsWith(".js")
        );
        const css = bundleOutputs.find(
          (output) => output.fileName.endsWith(".css")
        );
        const otherBundleOutputs = bundleOutputs.filter(
          (output) => output !== javascript
        );
        if (otherBundleOutputs.length > 0) {
          otherBundleOutputs.forEach(
            (output) => console.warn(`WARN Asset not inlined: ${output.fileName}`)
          );
        }
        const cssInHtml = css ? embedCss(html, css) : html;
        const minifiedHtml = await htmlMinify.minify(cssInHtml, options);
        return embedJs(minifiedHtml, javascript);
      }
    }
  };
}
async function embedJs(html, chunk) {
  const scriptTagRemoved = html.replace(
    new RegExp(`<script[^>]*?src=[./]*${chunk.fileName}[^>]*?></script>`),
    ""
  );
  const htmlInJs = `document.write('${scriptTagRemoved}');` + chunk.code.trim();
  const inputs = [
    {
      data: htmlInJs,
      type: "js",
      action: "eval"
    }
  ];
  let options;
  if (process.env.USE_RR_CONFIG) {
    try {
      options = JSON.parse(
        await fs.readFile(`${__vite_injected_original_dirname}/roadroller-config.json`, "utf-8")
      );
    } catch (error) {
      throw new Error(
        "Roadroller config not found. Generate one or use the regular build option"
      );
    }
  } else {
    options = { allowFreeVars: true };
  }
  const packer = new Packer(inputs, options);
  await Promise.all([
    fs.writeFile(`${path.join(__vite_injected_original_dirname, "dist")}/output.js`, htmlInJs),
    packer.optimize(2)
    // Regular builds use level 2
  ]);
  const { firstLine, secondLine } = packer.makeDecoder();
  return `<script>
${firstLine}
${secondLine}
</script>`;
}
function embedCss(html, asset) {
  const reCSS = new RegExp(
    `<link rel="stylesheet"[^>]*?href="[./]*${asset.fileName}"[^>]*?>`
  );
  const code = `<style>${new CleanCSS({ level: 2 }).minify(asset.source).styles}</style>`;
  return html.replace(reCSS, code);
}
function ectPlugin() {
  return {
    name: "vite:ect",
    writeBundle: async () => {
      try {
        const files = await fs.readdir("dist/");
        const assetFiles = files.filter((file) => {
          return !file.includes(".js") && !file.includes(".css") && !file.includes(".html") && !file.includes(".zip") && file !== "assets";
        }).map((file) => "dist/" + file);
        const args = [
          "-strip",
          "-zip",
          "-10009",
          "dist/index.html",
          ...assetFiles
        ];
        const result = execFileSync(ect, args);
        console.log("ECT result", result.toString().trim());
        const stats = statSync("dist/index.zip");
        console.log("ZIP size", stats.size);
      } catch (err) {
        console.log("ECT error", err);
      }
    }
  };
}
export {
  vite_config_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsidml0ZS5jb25maWcudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImNvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9kaXJuYW1lID0gXCJEOlxcXFxjb2RlXFxcXHRlbXBsYXJzLWZpbmFsLXN0YW5kLW1haW5cXFxcdGVtcGxhcnMtZmluYWwtc3RhbmQtbWFpblwiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9maWxlbmFtZSA9IFwiRDpcXFxcY29kZVxcXFx0ZW1wbGFycy1maW5hbC1zdGFuZC1tYWluXFxcXHRlbXBsYXJzLWZpbmFsLXN0YW5kLW1haW5cXFxcdml0ZS5jb25maWcudHNcIjtjb25zdCBfX3ZpdGVfaW5qZWN0ZWRfb3JpZ2luYWxfaW1wb3J0X21ldGFfdXJsID0gXCJmaWxlOi8vL0Q6L2NvZGUvdGVtcGxhcnMtZmluYWwtc3RhbmQtbWFpbi90ZW1wbGFycy1maW5hbC1zdGFuZC1tYWluL3ZpdGUuY29uZmlnLnRzXCI7aW1wb3J0IHsgZGVmaW5lQ29uZmlnLCBJbmRleEh0bWxUcmFuc2Zvcm1Db250ZXh0LCBQbHVnaW4gfSBmcm9tIFwidml0ZVwiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCBmcyBmcm9tIFwiZnMvcHJvbWlzZXNcIjtcbmltcG9ydCB0eXBlc2NyaXB0UGx1Z2luIGZyb20gXCJAcm9sbHVwL3BsdWdpbi10eXBlc2NyaXB0XCI7XG5pbXBvcnQgeyBPdXRwdXRBc3NldCwgT3V0cHV0Q2h1bmsgfSBmcm9tIFwicm9sbHVwXCI7XG5pbXBvcnQgeyBJbnB1dCwgSW5wdXRBY3Rpb24sIElucHV0VHlwZSwgUGFja2VyIH0gZnJvbSBcInJvYWRyb2xsZXJcIjtcbmltcG9ydCBDbGVhbkNTUyBmcm9tIFwiY2xlYW4tY3NzXCI7XG5pbXBvcnQgeyBzdGF0U3luYyB9IGZyb20gXCJmc1wiO1xuaW1wb3J0IHsgZXhlY0ZpbGVTeW5jIH0gZnJvbSBcImNoaWxkX3Byb2Nlc3NcIjtcbmltcG9ydCBlY3QgZnJvbSBcImVjdC1iaW5cIjtcbmltcG9ydCBodG1sTWluaWZ5IGZyb20gXCJodG1sLW1pbmlmaWVyXCI7XG5pbXBvcnQga29udHJhIGZyb20gXCJyb2xsdXAtcGx1Z2luLWtvbnRyYVwiO1xuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVDb25maWcoKHsgY29tbWFuZCwgbW9kZSB9KSA9PiB7XG4gIGNvbnN0IGNvbmZpZyA9IHtcbiAgICBzZXJ2ZXI6IHtcbiAgICAgIHBvcnQ6IDMwMDAsXG4gICAgfSxcbiAgICByZXNvbHZlOiB7XG4gICAgICBhbGlhczoge1xuICAgICAgICBcIkBcIjogcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgXCIuL3NyY1wiKSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBwbHVnaW5zOiB1bmRlZmluZWQsXG4gIH07XG5cbiAgaWYgKGNvbW1hbmQgPT09IFwiYnVpbGRcIikge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25maWcuZXNidWlsZCA9IGZhbHNlO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25maWcuYmFzZSA9IFwiXCI7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbmZpZy5idWlsZCA9IHtcbiAgICAgIG1pbmlmeTogXCJ0ZXJzZXJcIixcbiAgICAgIHRhcmdldDogXCJlczIwMjBcIixcbiAgICAgIG1vZHVsZVByZWxvYWQ6IHsgcG9seWZpbGw6IGZhbHNlIH0sXG4gICAgICBhc3NldHNJbmxpbmVMaW1pdDogODAwLFxuICAgICAgYXNzZXRzRGlyOiBcIlwiLFxuICAgICAgcm9sbHVwT3B0aW9uczoge1xuICAgICAgICBvdXRwdXQ6IHtcbiAgICAgICAgICBpbmxpbmVEeW5hbWljSW1wb3J0czogdHJ1ZSxcbiAgICAgICAgICBtYW51YWxDaHVua3M6IHVuZGVmaW5lZCxcbiAgICAgICAgICBhc3NldEZpbGVOYW1lczogYFtuYW1lXS5bZXh0XWAsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH07XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbmZpZy5wbHVnaW5zID0gW1xuICAgICAgdHlwZXNjcmlwdFBsdWdpbigpLFxuICAgICAgY2xvc3VyZVBsdWdpbigpLFxuICAgICAga29udHJhKHtcbiAgICAgICAgZ2FtZU9iamVjdDoge1xuICAgICAgICAgIGFuY2hvcjogdHJ1ZSxcbiAgICAgICAgICBncm91cDogdHJ1ZSxcbiAgICAgICAgICBvcGFjaXR5OiB0cnVlLFxuICAgICAgICAgIHNjYWxlOiB0cnVlLFxuICAgICAgICAgIHJhZGl1czogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgdGV4dDoge1xuICAgICAgICAgIGFsaWduOiB0cnVlLFxuICAgICAgICAgIG5ld2xpbmU6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICAgIHJvYWRyb2xsZXJQbHVnaW4oKSxcbiAgICAgIGVjdFBsdWdpbigpLFxuICAgIF07XG4gIH1cblxuICByZXR1cm4gY29uZmlnO1xufSk7XG5cbmZ1bmN0aW9uIGNsb3N1cmVQbHVnaW4oKTogUGx1Z2luIHtcbiAgcmV0dXJuIHtcbiAgICBuYW1lOiBcImNsb3N1cmUtY29tcGlsZXJcIixcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcmVuZGVyQ2h1bms6IGFwcGx5Q2xvc3VyZSxcbiAgICBlbmZvcmNlOiBcInBvc3RcIixcbiAgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gYXBwbHlDbG9zdXJlKGpzOiBzdHJpbmcsIGNodW5rOiBhbnkpIHtcbiAgLy8gcmVwbGFjZSBhbGwgY29uc3RzIHdpdGggbGV0cyB0byBzYXZlIGFib3V0IDUwLTcwIGJ5dGVzXG4gIC8vIEB0cy1pZ25vcmVcbiAganMgPSBqcy5yZXBsYWNlQWxsKFwiY29uc3QgXCIsIFwibGV0IFwiKTtcblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHJlc29sdmUoeyBjb2RlOiBqcyB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJvYWRyb2xsZXJQbHVnaW4oKTogUGx1Z2luIHtcbiAgcmV0dXJuIHtcbiAgICBuYW1lOiBcInZpdGU6cm9hZHJvbGxlclwiLFxuICAgIHRyYW5zZm9ybUluZGV4SHRtbDoge1xuICAgICAgZW5mb3JjZTogXCJwb3N0XCIsXG4gICAgICB0cmFuc2Zvcm06IGFzeW5jIChcbiAgICAgICAgaHRtbDogc3RyaW5nLFxuICAgICAgICBjdHg/OiBJbmRleEh0bWxUcmFuc2Zvcm1Db250ZXh0XG4gICAgICApOiBQcm9taXNlPHN0cmluZz4gPT4ge1xuICAgICAgICAvLyBPbmx5IHVzZSB0aGlzIHBsdWdpbiBkdXJpbmcgYnVpbGRcbiAgICAgICAgaWYgKCFjdHggfHwgIWN0eC5idW5kbGUpIHtcbiAgICAgICAgICByZXR1cm4gaHRtbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgaW5jbHVkZUF1dG9HZW5lcmF0ZWRUYWdzOiB0cnVlLFxuICAgICAgICAgIHJlbW92ZUF0dHJpYnV0ZVF1b3RlczogdHJ1ZSxcbiAgICAgICAgICByZW1vdmVDb21tZW50czogdHJ1ZSxcbiAgICAgICAgICByZW1vdmVSZWR1bmRhbnRBdHRyaWJ1dGVzOiB0cnVlLFxuICAgICAgICAgIHJlbW92ZVNjcmlwdFR5cGVBdHRyaWJ1dGVzOiB0cnVlLFxuICAgICAgICAgIHJlbW92ZVN0eWxlTGlua1R5cGVBdHRyaWJ1dGVzOiB0cnVlLFxuICAgICAgICAgIHNvcnRDbGFzc05hbWU6IHRydWUsXG4gICAgICAgICAgdXNlU2hvcnREb2N0eXBlOiB0cnVlLFxuICAgICAgICAgIGNvbGxhcHNlV2hpdGVzcGFjZTogdHJ1ZSxcbiAgICAgICAgICBjb2xsYXBzZUlubGluZVRhZ1doaXRlc3BhY2U6IHRydWUsXG4gICAgICAgICAgcmVtb3ZlRW1wdHlBdHRyaWJ1dGVzOiB0cnVlLFxuICAgICAgICAgIHJlbW92ZU9wdGlvbmFsVGFnczogdHJ1ZSxcbiAgICAgICAgICBzb3J0QXR0cmlidXRlczogdHJ1ZSxcbiAgICAgICAgICBtaW5pZnlDU1M6IHRydWUsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYnVuZGxlT3V0cHV0cyA9IE9iamVjdC52YWx1ZXMoY3R4LmJ1bmRsZSk7XG4gICAgICAgIGNvbnN0IGphdmFzY3JpcHQgPSBidW5kbGVPdXRwdXRzLmZpbmQoKG91dHB1dCkgPT5cbiAgICAgICAgICBvdXRwdXQuZmlsZU5hbWUuZW5kc1dpdGgoXCIuanNcIilcbiAgICAgICAgKSBhcyBPdXRwdXRDaHVuaztcbiAgICAgICAgY29uc3QgY3NzID0gYnVuZGxlT3V0cHV0cy5maW5kKChvdXRwdXQpID0+XG4gICAgICAgICAgb3V0cHV0LmZpbGVOYW1lLmVuZHNXaXRoKFwiLmNzc1wiKVxuICAgICAgICApIGFzIE91dHB1dEFzc2V0O1xuICAgICAgICBjb25zdCBvdGhlckJ1bmRsZU91dHB1dHMgPSBidW5kbGVPdXRwdXRzLmZpbHRlcihcbiAgICAgICAgICAob3V0cHV0KSA9PiBvdXRwdXQgIT09IGphdmFzY3JpcHRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKG90aGVyQnVuZGxlT3V0cHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgb3RoZXJCdW5kbGVPdXRwdXRzLmZvckVhY2goKG91dHB1dCkgPT5cbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgV0FSTiBBc3NldCBub3QgaW5saW5lZDogJHtvdXRwdXQuZmlsZU5hbWV9YClcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3NzSW5IdG1sID0gY3NzID8gZW1iZWRDc3MoaHRtbCwgY3NzKSA6IGh0bWw7XG4gICAgICAgIGNvbnN0IG1pbmlmaWVkSHRtbCA9IGF3YWl0IGh0bWxNaW5pZnkubWluaWZ5KGNzc0luSHRtbCwgb3B0aW9ucyk7XG4gICAgICAgIHJldHVybiBlbWJlZEpzKG1pbmlmaWVkSHRtbCwgamF2YXNjcmlwdCk7XG4gICAgICB9LFxuICAgIH0sXG4gIH07XG59XG5cbi8qKlxuICogVHJhbnNmb3JtcyB0aGUgZ2l2ZW4gSmF2YVNjcmlwdCBjb2RlIGludG8gYSBwYWNrZWQgdmVyc2lvbi5cbiAqIEBwYXJhbSBodG1sIFRoZSBvcmlnaW5hbCBIVE1MLlxuICogQHBhcmFtIGNodW5rIFRoZSBKYXZhU2NyaXB0IG91dHB1dCBjaHVuayBmcm9tIFJvbGx1cC9WaXRlLlxuICogQHJldHVybnMgVGhlIHRyYW5zZm9ybWVkIEhUTUwgd2l0aCB0aGUgSmF2YVNjcmlwdCBlbWJlZGRlZC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZW1iZWRKcyhodG1sOiBzdHJpbmcsIGNodW5rOiBPdXRwdXRDaHVuayk6IFByb21pc2U8c3RyaW5nPiB7XG4gIGNvbnN0IHNjcmlwdFRhZ1JlbW92ZWQgPSBodG1sLnJlcGxhY2UoXG4gICAgbmV3IFJlZ0V4cChgPHNjcmlwdFtePl0qP3NyYz1bXFwuL10qJHtjaHVuay5maWxlTmFtZX1bXj5dKj8+PC9zY3JpcHQ+YCksXG4gICAgXCJcIlxuICApO1xuICBjb25zdCBodG1sSW5KcyA9IGBkb2N1bWVudC53cml0ZSgnJHtzY3JpcHRUYWdSZW1vdmVkfScpO2AgKyBjaHVuay5jb2RlLnRyaW0oKTtcblxuICBjb25zdCBpbnB1dHM6IElucHV0W10gPSBbXG4gICAge1xuICAgICAgZGF0YTogaHRtbEluSnMsXG4gICAgICB0eXBlOiBcImpzXCIgYXMgSW5wdXRUeXBlLFxuICAgICAgYWN0aW9uOiBcImV2YWxcIiBhcyBJbnB1dEFjdGlvbixcbiAgICB9LFxuICBdO1xuXG4gIGxldCBvcHRpb25zO1xuICBpZiAocHJvY2Vzcy5lbnYuVVNFX1JSX0NPTkZJRykge1xuICAgIHRyeSB7XG4gICAgICBvcHRpb25zID0gSlNPTi5wYXJzZShcbiAgICAgICAgYXdhaXQgZnMucmVhZEZpbGUoYCR7X19kaXJuYW1lfS9yb2Fkcm9sbGVyLWNvbmZpZy5qc29uYCwgXCJ1dGYtOFwiKVxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIlJvYWRyb2xsZXIgY29uZmlnIG5vdCBmb3VuZC4gR2VuZXJhdGUgb25lIG9yIHVzZSB0aGUgcmVndWxhciBidWlsZCBvcHRpb25cIlxuICAgICAgKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgb3B0aW9ucyA9IHsgYWxsb3dGcmVlVmFyczogdHJ1ZSB9O1xuICB9XG5cbiAgY29uc3QgcGFja2VyID0gbmV3IFBhY2tlcihpbnB1dHMsIG9wdGlvbnMpO1xuICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgZnMud3JpdGVGaWxlKGAke3BhdGguam9pbihfX2Rpcm5hbWUsIFwiZGlzdFwiKX0vb3V0cHV0LmpzYCwgaHRtbEluSnMpLFxuICAgIHBhY2tlci5vcHRpbWl6ZSgyKSwgLy8gUmVndWxhciBidWlsZHMgdXNlIGxldmVsIDJcbiAgXSk7XG4gIGNvbnN0IHsgZmlyc3RMaW5lLCBzZWNvbmRMaW5lIH0gPSBwYWNrZXIubWFrZURlY29kZXIoKTtcbiAgcmV0dXJuIGA8c2NyaXB0PlxcbiR7Zmlyc3RMaW5lfVxcbiR7c2Vjb25kTGluZX1cXG48L3NjcmlwdD5gO1xufVxuXG4vKipcbiAqIEVtYmVkcyBDU1MgaW50byB0aGUgSFRNTC5cbiAqIEBwYXJhbSBodG1sIFRoZSBvcmlnaW5hbCBIVE1MLlxuICogQHBhcmFtIGFzc2V0IFRoZSBDU1MgYXNzZXQuXG4gKiBAcmV0dXJucyBUaGUgdHJhbnNmb3JtZWQgSFRNTCB3aXRoIHRoZSBDU1MgZW1iZWRkZWQuXG4gKi9cbmZ1bmN0aW9uIGVtYmVkQ3NzKGh0bWw6IHN0cmluZywgYXNzZXQ6IE91dHB1dEFzc2V0KTogc3RyaW5nIHtcbiAgY29uc3QgcmVDU1MgPSBuZXcgUmVnRXhwKFxuICAgIGA8bGluayByZWw9XCJzdHlsZXNoZWV0XCJbXj5dKj9ocmVmPVwiW1xcLi9dKiR7YXNzZXQuZmlsZU5hbWV9XCJbXj5dKj8+YFxuICApO1xuICBjb25zdCBjb2RlID0gYDxzdHlsZT4ke1xuICAgIG5ldyBDbGVhbkNTUyh7IGxldmVsOiAyIH0pLm1pbmlmeShhc3NldC5zb3VyY2UgYXMgc3RyaW5nKS5zdHlsZXNcbiAgfTwvc3R5bGU+YDtcbiAgcmV0dXJuIGh0bWwucmVwbGFjZShyZUNTUywgY29kZSk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyB0aGUgRUNUIHBsdWdpbiB0aGF0IHVzZXMgRWZmaWNpZW50LUNvbXByZXNzaW9uLVRvb2wgdG8gYnVpbGQgYSB6aXAgZmlsZS5cbiAqIEByZXR1cm5zIFRoZSBFQ1QgcGx1Z2luLlxuICovXG5mdW5jdGlvbiBlY3RQbHVnaW4oKTogUGx1Z2luIHtcbiAgcmV0dXJuIHtcbiAgICBuYW1lOiBcInZpdGU6ZWN0XCIsXG4gICAgd3JpdGVCdW5kbGU6IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgZnMucmVhZGRpcihcImRpc3QvXCIpO1xuICAgICAgICBjb25zdCBhc3NldEZpbGVzID0gZmlsZXNcbiAgICAgICAgICAuZmlsdGVyKChmaWxlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAhZmlsZS5pbmNsdWRlcyhcIi5qc1wiKSAmJlxuICAgICAgICAgICAgICAhZmlsZS5pbmNsdWRlcyhcIi5jc3NcIikgJiZcbiAgICAgICAgICAgICAgIWZpbGUuaW5jbHVkZXMoXCIuaHRtbFwiKSAmJlxuICAgICAgICAgICAgICAhZmlsZS5pbmNsdWRlcyhcIi56aXBcIikgJiZcbiAgICAgICAgICAgICAgZmlsZSAhPT0gXCJhc3NldHNcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5tYXAoKGZpbGUpID0+IFwiZGlzdC9cIiArIGZpbGUpO1xuICAgICAgICBjb25zdCBhcmdzID0gW1xuICAgICAgICAgIFwiLXN0cmlwXCIsXG4gICAgICAgICAgXCItemlwXCIsXG4gICAgICAgICAgXCItMTAwMDlcIixcbiAgICAgICAgICBcImRpc3QvaW5kZXguaHRtbFwiLFxuICAgICAgICAgIC4uLmFzc2V0RmlsZXMsXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGV4ZWNGaWxlU3luYyhlY3QsIGFyZ3MpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIkVDVCByZXN1bHRcIiwgcmVzdWx0LnRvU3RyaW5nKCkudHJpbSgpKTtcbiAgICAgICAgY29uc3Qgc3RhdHMgPSBzdGF0U3luYyhcImRpc3QvaW5kZXguemlwXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIlpJUCBzaXplXCIsIHN0YXRzLnNpemUpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRUNUIGVycm9yXCIsIGVycik7XG4gICAgICB9XG4gICAgfSxcbiAgfTtcbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7QUFBMlcsU0FBUyxvQkFBdUQ7QUFDM2EsT0FBTyxVQUFVO0FBQ2pCLE9BQU8sUUFBUTtBQUNmLE9BQU8sc0JBQXNCO0FBRTdCLFNBQXdDLGNBQWM7QUFDdEQsT0FBTyxjQUFjO0FBQ3JCLFNBQVMsZ0JBQWdCO0FBQ3pCLFNBQVMsb0JBQW9CO0FBQzdCLE9BQU8sU0FBUztBQUNoQixPQUFPLGdCQUFnQjtBQUN2QixPQUFPLFlBQVk7QUFYbkIsSUFBTSxtQ0FBbUM7QUFhekMsSUFBTyxzQkFBUSxhQUFhLENBQUMsRUFBRSxTQUFTLEtBQUssTUFBTTtBQUNqRCxRQUFNLFNBQVM7QUFBQSxJQUNiLFFBQVE7QUFBQSxNQUNOLE1BQU07QUFBQSxJQUNSO0FBQUEsSUFDQSxTQUFTO0FBQUEsTUFDUCxPQUFPO0FBQUEsUUFDTCxLQUFLLEtBQUssUUFBUSxrQ0FBVyxPQUFPO0FBQUEsTUFDdEM7QUFBQSxJQUNGO0FBQUEsSUFDQSxTQUFTO0FBQUEsRUFDWDtBQUVBLE1BQUksWUFBWSxTQUFTO0FBRXZCLFdBQU8sVUFBVTtBQUVqQixXQUFPLE9BQU87QUFFZCxXQUFPLFFBQVE7QUFBQSxNQUNiLFFBQVE7QUFBQSxNQUNSLFFBQVE7QUFBQSxNQUNSLGVBQWUsRUFBRSxVQUFVLE1BQU07QUFBQSxNQUNqQyxtQkFBbUI7QUFBQSxNQUNuQixXQUFXO0FBQUEsTUFDWCxlQUFlO0FBQUEsUUFDYixRQUFRO0FBQUEsVUFDTixzQkFBc0I7QUFBQSxVQUN0QixjQUFjO0FBQUEsVUFDZCxnQkFBZ0I7QUFBQSxRQUNsQjtBQUFBLE1BQ0Y7QUFBQSxJQUNGO0FBRUEsV0FBTyxVQUFVO0FBQUEsTUFDZixpQkFBaUI7QUFBQSxNQUNqQixjQUFjO0FBQUEsTUFDZCxPQUFPO0FBQUEsUUFDTCxZQUFZO0FBQUEsVUFDVixRQUFRO0FBQUEsVUFDUixPQUFPO0FBQUEsVUFDUCxTQUFTO0FBQUEsVUFDVCxPQUFPO0FBQUEsVUFDUCxRQUFRO0FBQUEsUUFDVjtBQUFBLFFBQ0EsTUFBTTtBQUFBLFVBQ0osT0FBTztBQUFBLFVBQ1AsU0FBUztBQUFBLFFBQ1g7QUFBQSxNQUNGLENBQUM7QUFBQSxNQUNELGlCQUFpQjtBQUFBLE1BQ2pCLFVBQVU7QUFBQSxJQUNaO0FBQUEsRUFDRjtBQUVBLFNBQU87QUFDVCxDQUFDO0FBRUQsU0FBUyxnQkFBd0I7QUFDL0IsU0FBTztBQUFBLElBQ0wsTUFBTTtBQUFBO0FBQUEsSUFFTixhQUFhO0FBQUEsSUFDYixTQUFTO0FBQUEsRUFDWDtBQUNGO0FBRUEsZUFBZSxhQUFhLElBQVksT0FBWTtBQUdsRCxPQUFLLEdBQUcsV0FBVyxVQUFVLE1BQU07QUFFbkMsU0FBTyxJQUFJLFFBQVEsQ0FBQyxTQUFTLFdBQVc7QUFDdEMsWUFBUSxFQUFFLE1BQU0sR0FBRyxDQUFDO0FBQUEsRUFDdEIsQ0FBQztBQUNIO0FBRUEsU0FBUyxtQkFBMkI7QUFDbEMsU0FBTztBQUFBLElBQ0wsTUFBTTtBQUFBLElBQ04sb0JBQW9CO0FBQUEsTUFDbEIsU0FBUztBQUFBLE1BQ1QsV0FBVyxPQUNULE1BQ0EsUUFDb0I7QUFFcEIsWUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLFFBQVE7QUFDdkIsaUJBQU87QUFBQSxRQUNUO0FBRUEsY0FBTSxVQUFVO0FBQUEsVUFDZCwwQkFBMEI7QUFBQSxVQUMxQix1QkFBdUI7QUFBQSxVQUN2QixnQkFBZ0I7QUFBQSxVQUNoQiwyQkFBMkI7QUFBQSxVQUMzQiw0QkFBNEI7QUFBQSxVQUM1QiwrQkFBK0I7QUFBQSxVQUMvQixlQUFlO0FBQUEsVUFDZixpQkFBaUI7QUFBQSxVQUNqQixvQkFBb0I7QUFBQSxVQUNwQiw2QkFBNkI7QUFBQSxVQUM3Qix1QkFBdUI7QUFBQSxVQUN2QixvQkFBb0I7QUFBQSxVQUNwQixnQkFBZ0I7QUFBQSxVQUNoQixXQUFXO0FBQUEsUUFDYjtBQUVBLGNBQU0sZ0JBQWdCLE9BQU8sT0FBTyxJQUFJLE1BQU07QUFDOUMsY0FBTSxhQUFhLGNBQWM7QUFBQSxVQUFLLENBQUMsV0FDckMsT0FBTyxTQUFTLFNBQVMsS0FBSztBQUFBLFFBQ2hDO0FBQ0EsY0FBTSxNQUFNLGNBQWM7QUFBQSxVQUFLLENBQUMsV0FDOUIsT0FBTyxTQUFTLFNBQVMsTUFBTTtBQUFBLFFBQ2pDO0FBQ0EsY0FBTSxxQkFBcUIsY0FBYztBQUFBLFVBQ3ZDLENBQUMsV0FBVyxXQUFXO0FBQUEsUUFDekI7QUFDQSxZQUFJLG1CQUFtQixTQUFTLEdBQUc7QUFDakMsNkJBQW1CO0FBQUEsWUFBUSxDQUFDLFdBQzFCLFFBQVEsS0FBSywyQkFBMkIsT0FBTyxRQUFRLEVBQUU7QUFBQSxVQUMzRDtBQUFBLFFBQ0Y7QUFFQSxjQUFNLFlBQVksTUFBTSxTQUFTLE1BQU0sR0FBRyxJQUFJO0FBQzlDLGNBQU0sZUFBZSxNQUFNLFdBQVcsT0FBTyxXQUFXLE9BQU87QUFDL0QsZUFBTyxRQUFRLGNBQWMsVUFBVTtBQUFBLE1BQ3pDO0FBQUEsSUFDRjtBQUFBLEVBQ0Y7QUFDRjtBQVFBLGVBQWUsUUFBUSxNQUFjLE9BQXFDO0FBQ3hFLFFBQU0sbUJBQW1CLEtBQUs7QUFBQSxJQUM1QixJQUFJLE9BQU8seUJBQTBCLE1BQU0sUUFBUSxrQkFBa0I7QUFBQSxJQUNyRTtBQUFBLEVBQ0Y7QUFDQSxRQUFNLFdBQVcsbUJBQW1CLGdCQUFnQixRQUFRLE1BQU0sS0FBSyxLQUFLO0FBRTVFLFFBQU0sU0FBa0I7QUFBQSxJQUN0QjtBQUFBLE1BQ0UsTUFBTTtBQUFBLE1BQ04sTUFBTTtBQUFBLE1BQ04sUUFBUTtBQUFBLElBQ1Y7QUFBQSxFQUNGO0FBRUEsTUFBSTtBQUNKLE1BQUksUUFBUSxJQUFJLGVBQWU7QUFDN0IsUUFBSTtBQUNGLGdCQUFVLEtBQUs7QUFBQSxRQUNiLE1BQU0sR0FBRyxTQUFTLEdBQUcsZ0NBQVMsMkJBQTJCLE9BQU87QUFBQSxNQUNsRTtBQUFBLElBQ0YsU0FBUyxPQUFPO0FBQ2QsWUFBTSxJQUFJO0FBQUEsUUFDUjtBQUFBLE1BQ0Y7QUFBQSxJQUNGO0FBQUEsRUFDRixPQUFPO0FBQ0wsY0FBVSxFQUFFLGVBQWUsS0FBSztBQUFBLEVBQ2xDO0FBRUEsUUFBTSxTQUFTLElBQUksT0FBTyxRQUFRLE9BQU87QUFDekMsUUFBTSxRQUFRLElBQUk7QUFBQSxJQUNoQixHQUFHLFVBQVUsR0FBRyxLQUFLLEtBQUssa0NBQVcsTUFBTSxDQUFDLGNBQWMsUUFBUTtBQUFBLElBQ2xFLE9BQU8sU0FBUyxDQUFDO0FBQUE7QUFBQSxFQUNuQixDQUFDO0FBQ0QsUUFBTSxFQUFFLFdBQVcsV0FBVyxJQUFJLE9BQU8sWUFBWTtBQUNyRCxTQUFPO0FBQUEsRUFBYSxTQUFTO0FBQUEsRUFBSyxVQUFVO0FBQUE7QUFDOUM7QUFRQSxTQUFTLFNBQVMsTUFBYyxPQUE0QjtBQUMxRCxRQUFNLFFBQVEsSUFBSTtBQUFBLElBQ2hCLDBDQUEyQyxNQUFNLFFBQVE7QUFBQSxFQUMzRDtBQUNBLFFBQU0sT0FBTyxVQUNYLElBQUksU0FBUyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsT0FBTyxNQUFNLE1BQWdCLEVBQUUsTUFDNUQ7QUFDQSxTQUFPLEtBQUssUUFBUSxPQUFPLElBQUk7QUFDakM7QUFNQSxTQUFTLFlBQW9CO0FBQzNCLFNBQU87QUFBQSxJQUNMLE1BQU07QUFBQSxJQUNOLGFBQWEsWUFBMkI7QUFDdEMsVUFBSTtBQUNGLGNBQU0sUUFBUSxNQUFNLEdBQUcsUUFBUSxPQUFPO0FBQ3RDLGNBQU0sYUFBYSxNQUNoQixPQUFPLENBQUMsU0FBUztBQUNoQixpQkFDRSxDQUFDLEtBQUssU0FBUyxLQUFLLEtBQ3BCLENBQUMsS0FBSyxTQUFTLE1BQU0sS0FDckIsQ0FBQyxLQUFLLFNBQVMsT0FBTyxLQUN0QixDQUFDLEtBQUssU0FBUyxNQUFNLEtBQ3JCLFNBQVM7QUFBQSxRQUViLENBQUMsRUFDQSxJQUFJLENBQUMsU0FBUyxVQUFVLElBQUk7QUFDL0IsY0FBTSxPQUFPO0FBQUEsVUFDWDtBQUFBLFVBQ0E7QUFBQSxVQUNBO0FBQUEsVUFDQTtBQUFBLFVBQ0EsR0FBRztBQUFBLFFBQ0w7QUFDQSxjQUFNLFNBQVMsYUFBYSxLQUFLLElBQUk7QUFDckMsZ0JBQVEsSUFBSSxjQUFjLE9BQU8sU0FBUyxFQUFFLEtBQUssQ0FBQztBQUNsRCxjQUFNLFFBQVEsU0FBUyxnQkFBZ0I7QUFDdkMsZ0JBQVEsSUFBSSxZQUFZLE1BQU0sSUFBSTtBQUFBLE1BQ3BDLFNBQVMsS0FBSztBQUNaLGdCQUFRLElBQUksYUFBYSxHQUFHO0FBQUEsTUFDOUI7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUNGOyIsCiAgIm5hbWVzIjogW10KfQo=
